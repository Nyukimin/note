# リファクタリングを捉えるための階層構造（拡張版）

## ❖ はじめに

リファクタリングは単なる技術的改善ではなく、企業の方向性や社会の要請に基づいた構造的な対応である。そこで、その意義や目的を多層的に捉えるために、以下のような抽象度の階層を定義する。

---

## 🏗 階層構造：上位から下位へ

### ① 社会の要請・時代の流れ
- **概要**: 社会全体が直面している課題や、価値観の変化
- **例**:
  - 少子高齢化による労働力不足
  - 働き方改革・多様な就労形態
  - DX（デジタルトランスフォーメーション）の加速
  - カギや受付業務の無人化ニーズ

---

### ② 企業の存在意義・ミッション
- **概要**: 社会に対して企業がどう貢献するか
- **例**:
  - 「テクノロジーで“人手不足”に立ち向かう」
  - 「物理空間の自律的な管理基盤をつくる」
  - Photosynth：キーレス社会のインフラへ

---

### ③ 製品ビジョン・役割
- **概要**: 製品が企業のミッションをどう体現しているか
- **例**:
  - Akerun → 入退室の可視化・効率化
  - Migakun → 現場作業の省人化と品質担保の仕組み
  - 顧客の現場課題（鍵管理・巡回・トラブル対応）を自動化・外注化

---

### ④ 機能・モジュール構造
- **概要**: 製品の中核を成す機能や構造
- **例**:
  - 認証（ICカード/スマホ/顔認証）
  - 履歴管理（クラウド保存/検索）
  - 鍵デバイス制御・スケジューラー・連携API
  - 清掃・備品補充・緊急対応フロー

---

### ⑤ コード（実装レベル）
- **概要**: 最終的に開発者が手を加える対象
- **例**:
  - 冗長なif文 → ステートマシン化
  - 責務の集中した巨大クラス → 単一責任に分割
  - 設定値のベタ書き → DI（依存性注入）への置換
  - テストしにくい構造 → Interface/Mockの導入

---

## 🔄 階層横断で考えるリファクタリング

各階層は独立しているのではなく、「下位は上位の目的を支える手段」であり、「上位は下位に方向性を与える目的」である。

> 例：  
> 少子高齢化（①）→ 無人化社会を支える（②）  
> → 鍵・施設管理の自動化（③）→ リモート開錠API/清掃フロー通知（④）  
> → 状態管理の簡潔なコード、拡張しやすい構成（⑤）

---

## ✅ この構造を使うメリット

- リファクタリングを**経営的・社会的意義とつなげて説明**できる
- CursorなどLLMとの対話の際にも**意図を上位概念から伝えられる**
- **全体像を見失わずに優先順位をつけて改善**に取り組める

---

## 📝 利用用途（例）

- 社内LTや技術共有の冒頭スライド
- チームのリファクタリング方針策定時のフレーム
- 経営層・PdMへの施策提案の論拠整理

